<!DOCTYPE html>
<html>
<head>
    <title>FURIA Know Your Fan</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-black text-white">
    <div id="root" class="p-4"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [data, setData] = useState(null);
            const [error, setError] = useState(null);

            const fetchData = async () => {
                try {
                    const res = await fetch('/api/fan/analyze');
                    if (!res.ok) throw new Error('Erro na API');
                    const json = await res.json();
                    setData(json);
                    setError(null);
                } catch (error) {
                    console.error('Erro ao buscar dados:', error);
                    setError('Falha ao carregar dados. Tente novamente.');
                    setData({ topWords: {}, sentiment: { positive: 0, negative: 0, neutral: 0 }, postsByDay: {} });
                }
            };

            useEffect(() => {
                fetchData();
            }, []);

            useEffect(() => {
                if (data) {
                    new Chart(document.getElementById('wordsChart'), {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data.topWords || {}),
                            datasets: [{
                                label: 'FrequÃªncia',
                                data: Object.values(data.topWords || {}),
                                backgroundColor: '#f97316'
                            }]
                        },
                        options: {
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });

                    new Chart(document.getElementById('postsChart'), {
                        type: 'line',
                        data: {
                            labels: Object.keys(data.postsByDay || {}).map(d => new Date(d).toLocaleDateString()),
                            datasets: [{
                                label: 'Posts',
                                data: Object.values(data.postsByDay || {}),
                                borderColor: '#f97316',
                                fill: false
                            }]
                        }
                    });
                }
            }, [data]);

            if (error) return <div className="text-red-500">{error}</div>;
            if (!data) return <div className="text-orange-500">Carregando...</div>;

            return (
                <div className="max-w-4xl mx-auto">
                    <h1 className="text-3xl text-orange-500 mb-4">FURIA Know Your Fan</h1>
                    <button 
                        onClick={fetchData} 
                        className="bg-orange-500 text-black px-4 py-2 rounded hover:bg-orange-600"
                    >
                        Atualizar Dados
                    </button>
                    <div className="grid grid-cols-2 gap-4 mt-4">
                        <div>
                            <h2 className="text-xl">Top Palavras</h2>
                            <canvas id="wordsChart"></canvas>
                        </div>
                        <div>
                            <h2 className="text-xl">Posts por Dia</h2>
                            <canvas id="postsChart"></canvas>
                        </div>
                        <div>
                            <h2 className="text-xl">Sentimento</h2>
                            <p>Positivo: {data.sentiment?.positive ?? 0}</p>
                            <p>Negativo: {data.sentiment?.negative ?? 0}</p>
                            <p>Neutro: {data.sentiment?.neutral ?? 0}</p>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>